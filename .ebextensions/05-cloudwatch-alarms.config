option_settings:
  # CloudWatch custom metrics
  aws:elasticbeanstalk:cloudwatch:logs:health:
    HealthStreamingEnabled: true
    DeleteOnTerminate: false
    RetentionInDays: 7

Resources:
  # CloudWatch Alarms for production monitoring
  
  # High CPU Alarm
  AWSEBCloudwatchAlarmHigh:
    Type: AWS::CloudWatch::Alarm
    Properties:
      AlarmDescription: "Alert when CPU exceeds 80%"
      MetricName: CPUUtilization
      Namespace: AWS/EC2
      Statistic: Average
      Period: 300
      EvaluationPeriods: 2
      Threshold: 80
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: EnvironmentName
          Value: { "Ref": "AWSEBEnvironmentName" }

  # Application 5xx Error Alarm
  AWSEBCloudwatchAlarm5xxErrors:
    Type: AWS::CloudWatch::Alarm
    Properties:
      AlarmDescription: "Alert on high 5xx error rate"
      MetricName: ApplicationRequests5xx
      Namespace: AWS/ElasticBeanstalk
      Statistic: Sum
      Period: 300
      EvaluationPeriods: 1
      Threshold: 10
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: EnvironmentName
          Value: { "Ref": "AWSEBEnvironmentName" }

  # Low Health Status Alarm
  AWSEBCloudwatchAlarmHealthStatus:
    Type: AWS::CloudWatch::Alarm
    Properties:
      AlarmDescription: "Alert when environment health is degraded"
      MetricName: EnvironmentHealth
      Namespace: AWS/ElasticBeanstalk
      Statistic: Average
      Period: 300
      EvaluationPeriods: 1
      Threshold: 15
      ComparisonOperator: GreaterThanThreshold
      Dimensions:
        - Name: EnvironmentName
          Value: { "Ref": "AWSEBEnvironmentName" }
