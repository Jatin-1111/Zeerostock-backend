commands:
  01_node_version_check:
    command: "node --version"
    ignoreErrors: true
  
  02_npm_version_check:
    command: "npm --version"
    ignoreErrors: true

container_commands:
  01_install_dependencies:
    command: "npm ci --only=production"
    cwd: /var/app/staging
    ignoreErrors: false
  
  02_print_env:
    command: "echo Production deployment started at $(date)"
    ignoreErrors: true

files:
  "/opt/elasticbeanstalk/tasks/bundlelogs.d/01-nodejs-logs.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      /var/log/nodejs/*.log
      /var/log/nginx/*.log

  "/etc/cron.d/cleanup_logs":
    mode: "000644"
    owner: root
    group: root
    content: |
      # Clean up old logs daily at 2 AM
      0 2 * * * root find /var/log/nodejs -name "*.log" -mtime +7 -delete
      0 2 * * * root find /var/log/nginx -name "*.log" -mtime +14 -delete
