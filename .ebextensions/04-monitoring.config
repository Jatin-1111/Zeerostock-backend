files:
  "/opt/elasticbeanstalk/hooks/appdeploy/pre/01_backup_env.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      # Backup environment variables before deployment
      echo "Deployment starting at $(date)" >> /var/log/deployment.log
      
  "/opt/elasticbeanstalk/hooks/appdeploy/post/01_restart_node.sh":
    mode: "000755"
    owner: root
    group: root
    content: |
      #!/bin/bash
      # Post-deployment hook - ensure node process is healthy
      echo "Deployment completed at $(date)" >> /var/log/deployment.log
      
      # Wait for app to be ready
      sleep 5
      
      # Check if app is responding
      curl -f http://localhost/health || echo "Health check failed" >> /var/log/deployment.log

  "/etc/logrotate.d/nodejs-app":
    mode: "000644"
    owner: root
    group: root
    content: |
      /var/log/nodejs/*.log {
          daily
          rotate 7
          missingok
          notifempty
          compress
          delaycompress
          copytruncate
          dateext
          dateformat -%Y%m%d-%s
      }
