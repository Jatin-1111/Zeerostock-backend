option_settings:
  # Node.js platform options
  aws:elasticbeanstalk:container:nodejs:
    NodeCommand: "node src/server.js"
    NodeVersion: 24.6.0
    GzipCompression: true
    ProxyServer: nginx

  # Environment properties
  aws:elasticbeanstalk:application:environment:
    NODE_ENV: production
    NPM_USE_PRODUCTION: true
    
  # Auto Scaling (FREE TIER: 1 instance only to stay within 750 hours/month)
  aws:autoscaling:asg:
    MinSize: 1
    MaxSize: 1
    Cooldown: 360

  # Instance type (FREE TIER: t3.micro eligible for 750 hours/month, better than t2.micro)
  aws:autoscaling:launchconfiguration:
    InstanceType: t3.micro
    RootVolumeSize: 10
    RootVolumeType: gp2
    IamInstanceProfile: aws-elasticbeanstalk-ec2-role
    MonitoringInterval: "1 minute"

  # Load Balancer health check
  aws:elasticbeanstalk:application:
    Application Healthcheck URL: /health

  # Enhanced health reporting
  aws:elasticbeanstalk:healthreporting:system:
    SystemType: enhanced
    EnhancedHealthAuthEnabled: true

  # CloudWatch Logs
  aws:elasticbeanstalk:cloudwatch:logs:
    StreamLogs: true
    DeleteOnTerminate: false
    RetentionInDays: 7

  # Rolling updates
  aws:elasticbeanstalk:command:
    DeploymentPolicy: RollingWithAdditionalBatch
    BatchSizeType: Fixed
    BatchSize: 1
    IgnoreHealthCheck: false
    Timeout: 600

  # Environment process
  aws:elasticbeanstalk:environment:process:default:
    HealthCheckPath: /health
    HealthCheckInterval: 30
    HealthCheckTimeout: 5
    UnhealthyThresholdCount: 3
    HealthyThresholdCount: 3
    DeregistrationDelay: 20
    Port: 80
    Protocol: HTTP
    StickinessEnabled: true
    StickinessLBCookieDuration: 86400
  # Load Balancer Type (Application Load Balancer)
  aws:elasticbeanstalk:environment:
    LoadBalancerType: application
    LoadBalancerIsShared: false
    ListenerEnabled: true
    ListenerProtocol: HTTP
    ListenerPort: 80
    RedirectHTTPToHTTPS: true

  # HTTP Listener (Port 80) - Redirect to HTTPS
  aws:elbv2:listener:default:
    ListenerEnabled: true
    Protocol: HTTP

  # HTTPS Listener (Port 443) - Main secure listener
  aws:elbv2:listener:443:
    ListenerEnabled: true
    Protocol: HTTPS
    SSLCertificateArns: arn:aws:acm:ap-south-1:154290454406:certificate/a33c228b-9184-4eca-9953-70fd5f1d0a46
    SSLPolicy: ELBSecurityPolicy-TLS13-1-2-2021-06
    DefaultProcess: default
    Rules: ''

  # HTTPS redirect action
  aws:elasticbeanstalk:environment:process:redirect:
    HealthCheckPath: /health
    Port: 443
    Protocol: HTTPS
  # Notification email for environment events (optional)
  aws:elasticbeanstalk:sns:topics:
    Notification Endpoint: contact@zeerostock.com  # Change this
    Notification Protocol: email
